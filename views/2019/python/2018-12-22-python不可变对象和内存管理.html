<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>python不可变对象和内存管理 | DJHS0</title>
    <meta name="description" content="djhs0 start.">
    <link rel="icon" href="/favicon.ico">
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.719cd97d.css" as="style"><link rel="preload" href="/assets/js/app.a7e07cd6.js" as="script"><link rel="preload" href="/assets/js/4.a1f779b1.js" as="script"><link rel="preload" href="/assets/js/1.06a8668e.js" as="script"><link rel="preload" href="/assets/js/17.a09a88ba.js" as="script"><link rel="prefetch" href="/assets/js/10.41ec4c56.js"><link rel="prefetch" href="/assets/js/11.fd2a4bc8.js"><link rel="prefetch" href="/assets/js/12.01975cf7.js"><link rel="prefetch" href="/assets/js/13.5d5df3b0.js"><link rel="prefetch" href="/assets/js/14.82538b57.js"><link rel="prefetch" href="/assets/js/15.6ce54c8c.js"><link rel="prefetch" href="/assets/js/16.740918c7.js"><link rel="prefetch" href="/assets/js/18.cce22eff.js"><link rel="prefetch" href="/assets/js/19.46cbe643.js"><link rel="prefetch" href="/assets/js/20.890808dc.js"><link rel="prefetch" href="/assets/js/5.ff361501.js"><link rel="prefetch" href="/assets/js/6.44158307.js"><link rel="prefetch" href="/assets/js/7.e4d52014.js"><link rel="prefetch" href="/assets/js/8.14deeaeb.js"><link rel="prefetch" href="/assets/js/9.b33a9c1e.js"><link rel="prefetch" href="/assets/js/vendors~flowchart.cd2faf37.js">
    <link rel="stylesheet" href="/assets/css/0.styles.719cd97d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div><div class="theme-container"><div><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/head.png" alt="DJHS0" class="logo"> <span class="site-name">DJHS0</span></a> <div class="links"><div class="color-picker"><a href="#" class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="theme-options"><!----> <div class="dark-theme-options toggle-option"><label for="dark-theme-toggle">Enable Dark Theme?</label> <input id="dark-theme-toggle" type="checkbox" checked="checked"></div></div></div></div> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/category/django.html" class="nav-link"><i class="iconfont undefined"></i>
  django
</a></li><li class="dropdown-item"><!----> <a href="/category/python.html" class="nav-link"><i class="iconfont undefined"></i>
  python
</a></li><li class="dropdown-item"><!----> <a href="/category/windows.html" class="nav-link"><i class="iconfont undefined"></i>
  windows
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/timeLine/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/dongdawang" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/category/django.html" class="nav-link"><i class="iconfont undefined"></i>
  django
</a></li><li class="dropdown-item"><!----> <a href="/category/python.html" class="nav-link"><i class="iconfont undefined"></i>
  python
</a></li><li class="dropdown-item"><!----> <a href="/category/windows.html" class="nav-link"><i class="iconfont undefined"></i>
  windows
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/timeLine/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/dongdawang" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>python不可变对象和内存管理</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/views/2019/python/2018-12-22-python%E4%B8%8D%E5%8F%AF%E5%8F%98%E5%AF%B9%E8%B1%A1%E5%92%8C%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86.html#id函数的定义" class="sidebar-link">id函数的定义</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/views/2019/python/2018-12-22-python%E4%B8%8D%E5%8F%AF%E5%8F%98%E5%AF%B9%E8%B1%A1%E5%92%8C%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86.html#小整数池" class="sidebar-link">小整数池</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/views/2019/python/2018-12-22-python%E4%B8%8D%E5%8F%AF%E5%8F%98%E5%AF%B9%E8%B1%A1%E5%92%8C%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86.html#字符串" class="sidebar-link">字符串</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/views/2019/python/2018-12-22-python%E4%B8%8D%E5%8F%AF%E5%8F%98%E5%AF%B9%E8%B1%A1%E5%92%8C%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86.html#缓存区" class="sidebar-link">缓存区</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/views/2019/python/2018-12-22-python%E4%B8%8D%E5%8F%AF%E5%8F%98%E5%AF%B9%E8%B1%A1%E5%92%8C%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86.html#内存分为3个区域" class="sidebar-link">内存分为3个区域</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/views/2019/python/2018-12-22-python%E4%B8%8D%E5%8F%AF%E5%8F%98%E5%AF%B9%E8%B1%A1%E5%92%8C%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86.html#内存管理的方法" class="sidebar-link">内存管理的方法</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/views/2019/python/2018-12-22-python%E4%B8%8D%E5%8F%AF%E5%8F%98%E5%AF%B9%E8%B1%A1%E5%92%8C%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86.html#引用计数" class="sidebar-link">引用计数</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/views/2019/python/2018-12-22-python%E4%B8%8D%E5%8F%AF%E5%8F%98%E5%AF%B9%E8%B1%A1%E5%92%8C%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86.html#垃圾回收" class="sidebar-link">垃圾回收</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/views/2019/python/2018-12-22-python%E4%B8%8D%E5%8F%AF%E5%8F%98%E5%AF%B9%E8%B1%A1%E5%92%8C%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86.html#引入分代回收解决的问题" class="sidebar-link">引入分代回收解决的问题</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/views/2019/python/2018-12-22-python%E4%B8%8D%E5%8F%AF%E5%8F%98%E5%AF%B9%E8%B1%A1%E5%92%8C%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86.html#循环引用的解决" class="sidebar-link">循环引用的解决</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <div><main class="page reco-hide"> <div class="page-title"><h1>python不可变对象和内存管理</h1> <hr> <div data-v-0b496ca7><i class="iconfont reco-account" data-v-0b496ca7><span data-v-0b496ca7>djhs0</span></i> <i class="iconfont reco-date" data-v-0b496ca7><span data-v-0b496ca7>2018-12-22</span></i> <span id="/views/2019/python/2018-12-22-python%E4%B8%8D%E5%8F%AF%E5%8F%98%E5%AF%B9%E8%B1%A1%E5%92%8C%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86.html" data-flag-title="Your Article Title" class="leancloud-visitors" data-v-2e99e05a data-v-0b496ca7><i class="iconfont reco-eye" style="margin-right: .5rem" data-v-2e99e05a></i> <a class="leancloud-visitors-count" style="font-size:.9rem;font-weight:normal;color:#999;" data-v-2e99e05a></a></span> <i class="iconfont reco-tag tags" data-v-0b496ca7><span class="tag-item" data-v-0b496ca7>
      内存管理
    </span><span class="tag-item" data-v-0b496ca7>
      不可变对象
    </span></i></div></div> <div class="content__default"><h1 id="python的不可变对象"><a href="#python的不可变对象" aria-hidden="true" class="header-anchor">#</a> python的不可变对象</h1> <p>int,string,float,tuple在python中都是不可变对象。</p> <h2 id="id函数的定义"><a href="#id函数的定义" aria-hidden="true" class="header-anchor">#</a> id函数的定义</h2> <blockquote><p>Return the “identity” of an object. This is an integer (or long integer) which is guaranteed to be unique and constant for this object during its lifetime. Two objects with non-overlapping lifetimes may have the same id()value.</p></blockquote> <p>在不重叠的生命周期内，两个对象可能有同样的id值。
所以在使用时，每个对象都有一个独一无二的值。</p> <h2 id="小整数池"><a href="#小整数池" aria-hidden="true" class="header-anchor">#</a> 小整数池</h2> <p>python为了避免经常使用的小整数不断的在内存中被创建，所以在解释器已启动的时候就将[-5,256]的数字都创建了，所以它们的id是不变的。</p> <h2 id="字符串"><a href="#字符串" aria-hidden="true" class="header-anchor">#</a> 字符串</h2> <p>字符串也有缓存区，分为固定缓存区和可重复缓存区<br>
固定的是256个ASCII码字符</p> <h2 id="缓存区"><a href="#缓存区" aria-hidden="true" class="header-anchor">#</a> 缓存区</h2> <p>dict和list也有缓存区，大小为80个对象。</p> <h2 id="内存分为3个区域"><a href="#内存分为3个区域" aria-hidden="true" class="header-anchor">#</a> 内存分为3个区域</h2> <p>事先分配的静态内存，事先分配的可重复利用的内存以及需要通过malloc和free来控制的自由内存。</p> <h1 id="python的内存管理"><a href="#python的内存管理" aria-hidden="true" class="header-anchor">#</a> python的内存管理</h1> <h2 id="内存管理的方法"><a href="#内存管理的方法" aria-hidden="true" class="header-anchor">#</a> 内存管理的方法</h2> <ol><li>引用计数</li> <li>垃圾回收
引用计数决定了当前的对象是否需要被释放，垃圾回收解决了循环引用的问题，同时也对外提供了手动释放内存的接口。</li></ol> <h2 id="引用计数"><a href="#引用计数" aria-hidden="true" class="header-anchor">#</a> 引用计数</h2> <p>python使用引用计数来标明某块内存是否还在被使用，每个对象都有一个引用计数器count，记录着这个变量被引用了多少次，当一个对象的引用计数为0的时候，如果这个对象在缓存区里，那么它的地址空间不会被释放，而是等待下一个的使用，如果在非缓存区，则会被释放。<br>
可以使用sys.getrefcount()来查看一个对象的引用计数</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">import</span> sys
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> sys<span class="token punctuation">.</span>getrefcount<span class="token punctuation">(</span>a<span class="token punctuation">)</span>
<span class="token number">2</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> sys<span class="token punctuation">.</span>getrefcount<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token number">1</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="垃圾回收"><a href="#垃圾回收" aria-hidden="true" class="header-anchor">#</a> 垃圾回收</h2> <p>垃圾回收解决了循环引用的问题<br>
在python对象的生命周期中，即使python对象的引用为0，python的垃圾回收也不会立刻将它从内存中清除，而是等到引用为0的对象到达一定规模了的时候才会回收一次垃圾。<br>
GC模块回收方法：</p> <ol><li>将对象分为3代，0代，1代，2代。</li> <li>当0代对象的引用为0的个数为700时，则启动一次0代对象垃圾回收。</li> <li>当0代对象垃圾回收执行10次之后，就进行一次0代和1代垃圾回收。</li> <li>当1代垃圾会后执行10次之后，就进行一次0代，1代，2代的垃圾回收。
对象代数计算：初始时，所有对象都是0代，0代对象经过一次垃圾回收，没有被释放的对象归为1代，同理，2代是1代对象经过一次次垃圾回收没有被回收的对象。</li></ol> <p>分代：典型的空间换时间</p> <h2 id="引入分代回收解决的问题"><a href="#引入分代回收解决的问题" aria-hidden="true" class="header-anchor">#</a> 引入分代回收解决的问题</h2> <p>经过统计，在垃圾回收过程中，如果对象一开始没有被回收，那么这个对象就可能存在很久。</p> <h2 id="循环引用的解决"><a href="#循环引用的解决" aria-hidden="true" class="header-anchor">#</a> 循环引用的解决</h2> <p>循环引用只能由容器创建，所以python的垃圾回收不需要跟踪整数，字符串等类型。</p> <p>垃圾回收使用了标记-清除算法：基于追踪回收。<br>
标记-清除算法是作为python的辅助垃圾回收方法，主要用于处理一些容器对象。缺点：回收之前要扫描整个堆内存。<br>
分代回收是建立于标记-清除机制之上的。</p></div> <!----> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">7/14/2019, 3:31:01 PM</span></div></footer> <!----> </main> <div class="valine-wrapper" data-v-0162251c><div id="valine" data-v-0162251c></div></div></div> <div class="back-to-ceiling" style="right:1rem;bottom:3rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;background-color:rgba(231, 234, 241,.5);display:none;" data-v-d0bfeaa4 data-v-d0bfeaa4><i class="iconfont reco-up" data-v-d0bfeaa4></i></div></div></div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.a7e07cd6.js" defer></script><script src="/assets/js/4.a1f779b1.js" defer></script><script src="/assets/js/1.06a8668e.js" defer></script><script src="/assets/js/17.a09a88ba.js" defer></script>
  </body>
</html>
